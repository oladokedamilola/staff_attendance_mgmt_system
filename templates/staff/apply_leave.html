{% extends "base_user.html" %}
{% block title %}Apply for Leave - StaffHub{% endblock %}

{% block content %}
<div class="container py-5 d-flex justify-content-center">
  <div class="card shadow-sm rounded-4 border-0 w-100" style="max-width: 600px;">
    <div class="card-header bg-white border-0 pb-0">
      <h4 class="fw-bold mb-0">
        <i class="bi bi-calendar-plus me-2 text-primary"></i> Apply for Leave
      </h4>
    </div>
    <div class="card-body">

      <form method="post" enctype="multipart/form-data" novalidate>
        {% csrf_token %}
        {{ form.non_field_errors }}

        <!-- Leave Type -->
        <div class="mb-3">
          <label for="{{ form.leave_type.id_for_label }}" class="form-label">
            <i class="bi bi-list-task me-1 text-muted"></i> Leave Type
          </label>
          {{ form.leave_type }}
          {% for error in form.leave_type.errors %}
            <div class="invalid-feedback d-block">{{ error }}</div>
          {% endfor %}
        </div>

        <!-- Start Date -->
        <div class="mb-3">
          <label for="{{ form.start_date.id_for_label }}" class="form-label">
            <i class="bi bi-calendar-event me-1 text-muted"></i> Start Date
          </label>
          {{ form.start_date }}
          {% for error in form.start_date.errors %}
            <div class="invalid-feedback d-block">{{ error }}</div>
          {% endfor %}
        </div>

        <!-- End Date -->
        <div class="mb-3">
          <label for="{{ form.end_date.id_for_label }}" class="form-label">
            <i class="bi bi-calendar-check me-1 text-muted"></i> End Date
          </label>
          {{ form.end_date }}
          {% for error in form.end_date.errors %}
            <div class="invalid-feedback d-block">{{ error }}</div>
          {% endfor %}
        </div>

        <!-- Reason -->
        <div class="mb-3">
          <label for="{{ form.reason.id_for_label }}" class="form-label">
            <i class="bi bi-chat-left-text me-1 text-muted"></i> Reason
          </label>
          {{ form.reason }}
          {% for error in form.reason.errors %}
            <div class="invalid-feedback d-block">{{ error }}</div>
          {% endfor %}
        </div>

        <!-- Evidence (hidden until Sick Leave selected) -->
        <div class="mb-3" id="evidenceField" style="display:none;">
          <label for="{{ form.evidence.id_for_label }}" class="form-label">
            <i class="bi bi-file-earmark-text me-1 text-muted"></i> Evidence File
          </label>
          {{ form.evidence }}
          <small class="form-text text-muted">Required for Sick Leave (document or image).</small>
          {% for error in form.evidence.errors %}
            <div class="invalid-feedback d-block">{{ error }}</div>
          {% endfor %}
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn btn-primary w-100 py-2 shadow-sm rounded-3">
          <i class="bi bi-send me-2"></i> Submit Request
        </button>
      </form>

    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const leaveType = document.getElementById("id_leave_type");
    const evidenceField = document.getElementById("evidenceField");

    function toggleEvidence() {
      if (leaveType.value === "sick") {
        evidenceField.style.display = "block";
      } else {
        evidenceField.style.display = "none";
      }
    }

    // Run on page load + when leave type changes
    toggleEvidence();
    leaveType.addEventListener("change", toggleEvidence);
  });
</script>
{% endblock %}
