{% extends "base_user.html" %}
{% block title %}Leave Requests{% endblock %}

{% block content %}
<div class="container py-5">

  <!-- Pending Leaves Table -->
  <h2 class="mb-4">Pending Leave Requests</h2>
  <div class="card shadow-sm mb-5">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-striped table-hover mb-0">
          <thead>
            <tr>
              <th>Staff</th>
              <th>Type</th>
              <th>Dates</th>
              <th>Reason</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for leave in pending_leaves %}
            <tr>
              <td>{{ leave.staff.get_full_name }}</td>
              <td>{{ leave.get_leave_type_display }}</td>
              <td>{{ leave.start_date }} → {{ leave.end_date }}</td>
              <td>{{ leave.reason|truncatechars:30 }}</td>
              <td>
                <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#leaveModal{{ leave.id }}">
                  <i class="bi bi-eye me-1"></i> View
                </button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      {% if pending_leaves.has_previous or pending_leaves.has_next %}
      <div class="d-flex justify-content-end p-3">
        <nav>
          <ul class="pagination mb-0">
            {% if pending_leaves.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?pending_page={{ pending_leaves.previous_page_number }}#pending">&laquo;</a>
            </li>
            {% else %}
            <li class="page-item disabled"><span class="page-link">&laquo;</span></li>
            {% endif %}

            {% if pending_leaves.has_next or pending_leaves.has_previous %}
            <li class="page-item disabled"><span class="page-link">Page {{ pending_leaves.number }} of {{ pending_leaves.paginator.num_pages }}</span></li>
            {% endif %}

            {% if pending_leaves.has_next %}
            <li class="page-item">
              <a class="page-link" href="?pending_page={{ pending_leaves.next_page_number }}#pending">&raquo;</a>
            </li>
            {% else %}
            <li class="page-item disabled"><span class="page-link">&raquo;</span></li>
            {% endif %}
          </ul>
        </nav>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Spacer between tables -->
  <div class="mb-5"></div>

  <!-- Approved Leaves Table -->
  <h2 class="mb-4">Approved Leave Requests</h2>
  <div class="card shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-striped table-hover mb-0">
          <thead>
            <tr>
              <th>Staff</th>
              <th>Type</th>
              <th>Dates</th>
              <th>Reason</th>
            </tr>
          </thead>
          <tbody>
            {% for leave in approved_leaves %}
            <tr data-bs-toggle="modal" data-bs-target="#approvedLeaveModal{{ leave.id }}" style="cursor: pointer;">
              <td>{{ leave.staff.get_full_name }}</td>
              <td>{{ leave.get_leave_type_display }}</td>
              <td>{{ leave.start_date }} → {{ leave.end_date }}</td>
              <td>{{ leave.reason|truncatechars:30 }}</td>
            </tr>

            <!-- Approved Leave Modal -->
            <div class="modal fade" id="approvedLeaveModal{{ leave.id }}" tabindex="-1" aria-labelledby="approvedLeaveModalLabel{{ leave.id }}" aria-hidden="true">
              <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content rounded-4 shadow-lg">
                  <div class="modal-header bg-light">
                    <h5 class="modal-title" id="approvedLeaveModalLabel{{ leave.id }}">Leave Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <ul class="list-group list-group-flush">
                      <li class="list-group-item"><strong>Staff:</strong> {{ leave.staff.get_full_name }} ({{ leave.staff.email }})</li>
                      <li class="list-group-item"><strong>Leave Type:</strong> {{ leave.get_leave_type_display }}</li>
                      <li class="list-group-item"><strong>Start Date:</strong> {{ leave.start_date }}</li>
                      <li class="list-group-item"><strong>End Date:</strong> {{ leave.end_date }}</li>
                      <li class="list-group-item"><strong>Reason:</strong><br>{{ leave.reason }}</li>
                      {% if leave.evidence %}
                        <li class="list-group-item">
                          <strong>Evidence:</strong><br>
                          {% if leave.evidence.url|lower|slice:"-4:" in ".jpg,.png,.gif" %}
                            <img src="{{ leave.evidence.url }}" alt="Evidence" class="img-fluid rounded shadow-sm">
                          {% else %}
                            <a href="{{ leave.evidence.url }}" target="_blank" class="btn btn-sm btn-outline-secondary">
                              <i class="bi bi-file-earmark-text"></i> View Document
                            </a>
                          {% endif %}
                        </li>
                      {% endif %}
                    </ul>
                  </div>
                  <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </tbody>
        </table>
      </div>

      {% if approved_leaves.has_previous or approved_leaves.has_next %}
      <div class="d-flex justify-content-end p-3">
        <nav>
          <ul class="pagination mb-0">
            {% if approved_leaves.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?approved_page={{ approved_leaves.previous_page_number }}#approved">&laquo;</a>
            </li>
            {% else %}
            <li class="page-item disabled"><span class="page-link">&laquo;</span></li>
            {% endif %}

            {% if approved_leaves.has_next or approved_leaves.has_previous %}
            <li class="page-item disabled"><span class="page-link">Page {{ approved_leaves.number }} of {{ approved_leaves.paginator.num_pages }}</span></li>
            {% endif %}

            {% if approved_leaves.has_next %}
            <li class="page-item">
              <a class="page-link" href="?approved_page={{ approved_leaves.next_page_number }}#approved">&raquo;</a>
            </li>
            {% else %}
            <li class="page-item disabled"><span class="page-link">&raquo;</span></li>
            {% endif %}
          </ul>
        </nav>
      </div>
      {% endif %}
    </div>
  </div>

</div>
{% endblock %}

{% block footer %}{% endblock %}
