{% extends "base_user.html" %}
{% load static %}

{% block title %}Manage Staff{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">Manage Staff</h2>
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#inviteStaffModal">
      <i class="bi bi-person-plus"></i> Invite Staff
    </button>
  </div>

  <div class="card shadow-sm rounded-4 border-0">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-striped table-hover mb-0 align-middle">
          <thead class="table-light">
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for staff in staff_list %}
            <tr class="align-middle">
              <td>{{ staff.get_full_name }}</td>
              <td>{{ staff.email }}</td>
              <td class="text-end">
                <button 
                  class="btn btn-sm btn-outline-primary" 
                  data-bs-toggle="modal" 
                  data-bs-target="#viewStaffModal{{ staff.id }}">
                  <i class="bi bi-eye"></i> View
                </button>
              </td>
            </tr>

            <!-- Staff Details Modal -->
            <div class="modal fade" id="viewStaffModal{{ staff.id }}" tabindex="-1" aria-labelledby="viewStaffModalLabel{{ staff.id }}" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content rounded-4 shadow-lg border-0">
                  <div class="modal-header bg-light border-bottom-0">
                    <h5 class="modal-title" id="viewStaffModalLabel{{ staff.id }}">
                      {{ staff.get_full_name }}'s Details
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <div class="d-flex flex-column flex-md-row align-items-center align-items-md-start gap-4">
                      <!-- Profile Image -->
                      <div class="text-center flex-shrink-0">
                        {% if staff.profile_image %}
                          <img src="{{ staff.profile_image.url }}" alt="Profile Image" class="rounded-circle shadow-sm" style="width: 140px; height: 140px; object-fit: cover;">
                        {% else %}
                          <img src="{% static 'profile_images/default-avatar.png' %}" alt="Default Avatar" class="rounded-circle shadow-sm" style="width: 140px; height: 140px; object-fit: cover;">
                        {% endif %}
                      </div>

                      <!-- Staff Info -->
                      <div class="flex-grow-1 w-100">
                        <ul class="list-group list-group-flush">
                          <li class="list-group-item"><strong>Full Name:</strong> {{ staff.get_full_name }}</li>
                          <li class="list-group-item"><strong>Email:</strong> {{ staff.email }}</li>
                          <li class="list-group-item"><strong>Role:</strong> {{ staff.get_role_display }}</li>
                          <li class="list-group-item"><strong>Date Joined:</strong> {{ staff.date_joined|date:"M d, Y" }}</li>
                          <li class="list-group-item"><strong>Last Login:</strong> {{ staff.last_login|date:"M d, Y H:i" }}</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                  <div class="modal-footer bg-light border-top-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  </div>
                </div>
              </div>
            </div>
            <!-- End Modal -->

            {% empty %}
            <tr>
              <td colspan="3" class="text-center text-muted py-4">
                No staff members found.
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Invite Staff Modal -->
<div class="modal fade" id="inviteStaffModal" tabindex="-1" aria-labelledby="inviteStaffModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4 shadow-lg border-0">
      <div class="modal-header bg-light border-bottom-0">
        <h5 class="modal-title" id="inviteStaffModalLabel">Invite New Staff</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form method="post" action="{% url 'send_staff_invite' %}">
          {% csrf_token %}
          <div class="mb-3">
            <label for="staffEmail" class="form-label">Staff Email</label>
            <input type="email" class="form-control" id="staffEmail" name="email" placeholder="Enter staff email" required>
          </div>
          <div class="mb-3">
            <label for="staffRole" class="form-label">Role</label>
            <select class="form-select" id="staffRole" name="role" required>
              <option value="">Select role</option>
              <option value="staff">Staff</option>
              <option value="admin">Admin</option>
            </select>
          </div>
          <div class="d-grid">
            <button type="submit" class="btn btn-primary">Send Invite</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block footer %}{% endblock %}
